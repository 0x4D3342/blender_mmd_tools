# MMD Tools

MMD Toolsはblender 2.66以降対応のMMDモデル(.pmx)およびモーションデータ(.vmd)インポータです。

## 作者

sugiany

## 対応バージョン

blender 2.66以降

## ライセンス

MIT License

## インストール方法

mmd_toolsディレクトリをaddonディレクトリにコピーしてください。

## 使用方法

### Addonのロード

1. User PrefernceのAddonsから"Object: MMD Tools"探してチェックを入れてください。
   (検索ボックスにmmdと入力すると簡単に探せます。)
2. 3D View左のパネルにMMD Toolsのパネルが表示されます。

### MMDモデルデータ読み込み

1. MMD Toolsパネルの"import pmx"ボタンを選択してください。
2. ファイル選択画面でpmxファイルを選択すると、選択されたモデルをインポートします。

### モーションデータの読み込み

1. あらかじめ読み込んでおいたモデルのMeshとArmature、Cameraを選択してください。(選択していない項目はインポートされません)
2. MMD Toolsパネルの"import vmd"ボタンを選択してください。
3. ファイル選択画面でvmdファイルを選択すると選択中のオブジェクトへモーションをインポートします。

### その他の機能

#### separate by materials

選択したメッシュオブジェクトのメッシュをマテリアル毎に分割し、分割後のオブジェクト名を各マテリアル名に変更します。blenderデフォルトの"Separate"→"By Material"機能を使用しています。

#### to cycles

選択したメッシュオブジェクトのblenderRender用マテリアルをcycles用に変換します。何の根拠もない適当な変換です。
完了メッセージなどは表示されません。マテリアルパネルから変換されているかどうか確認してください。
また、マテリアルパネルから一部の設定値がドラッグで変更できない不具合があります。(reflectionなど)
値を変更する場合は、値を直接入力してください。

#### auto scene setup

pmxインポート後に適当な設定ですぐレンダリングできるよう自動設定を行います。

1. FrameRangeおよびRigid Body Cacheの範囲をシーン上アニメーションのレンジに合わせます。
2. "Ambient Occlusion"、"Environment Lighting"および"Indirect Lighting"をオンにします。
3. フレームレートを30fpsに変更します。


## 剛体について

剛体およびJoint情報をインポートできますが下記制限があります。

1. ばねに関する情報は無視します。
2. Jointで接続した2オブジェクトはお互いに衝突しなくなります。（具体例としてMMD標準ミクの前髪が頭にめり込みます。）

上記2.の問題は下記手順で解決できますが、やや複雑な操作ですので将来のバージョンで何かしら改善する予定です。

1. 問題を解決したいJointを選択してください。(J:から始まる名前を持つemptyオブジェクトです)
2. Physicsパネルを開き、"Rigid Body Constraint"の"Disable Collisions"のチェックをはずしてください。

## その他

* カメラとキャラクタモーションが別ファイルの場合は、ArmatureとMeshを選択してキャラモーション、Cameraを選択してカメラモーションというように2回に分けてインポートしてください。
* モーションデータのアサインは"MMD Tools"でインポートしたモデルのみ可能です。
* カメラはMMD_Cameraという名前のEmptyオブジェクトを生成し、このオブジェクトにモーションをアサインします。
* 複数のモーションをインポートする場合やフレームにオフセットをつけてインポートしたい場合は、NLAエディタでアニメーションを編集してください。
* pmdのインポートには対応していません。pmdモデルを読み込みたい場合は、PMDEditorでpmx形式に変換してからインポートしてください。(将来的には対応したいです。)
* pmxインポートについて
    * 頂点のウェイト情報がSDEFの場合、BDEF2と同じ扱いを行います。
    * 頂点モーフ以外のモーフ情報には対応していません。
    * 剛体設定の"物理+ボーン位置合わせ"は"物理演算"として扱います。
